<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 2 Life Expenctancy | David Tran Thanh Dat</title>
<meta name="author" content="Tran Thanh Dat">
<meta name="description" content='2.1 Mortality rates The following codes compare mortality rates across the ages ranging from zero to one hundred and ten. full_df = read.csv("/cloud/project/csvfiles/full_df.csv") %&gt;% mutate(qx =...'>
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="Chapter 2 Life Expenctancy | David Tran Thanh Dat">
<meta property="og:type" content="book">
<meta property="og:description" content='2.1 Mortality rates The following codes compare mortality rates across the ages ranging from zero to one hundred and ten. full_df = read.csv("/cloud/project/csvfiles/full_df.csv") %&gt;% mutate(qx =...'>
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 2 Life Expenctancy | David Tran Thanh Dat">
<meta name="twitter:description" content='2.1 Mortality rates The following codes compare mortality rates across the ages ranging from zero to one hundred and ten. full_df = read.csv("/cloud/project/csvfiles/full_df.csv") %&gt;% mutate(qx =...'>
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">David Tran Thanh Dat</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About me</a></li>
<li><a class="" href="skills.html">Skills</a></li>
<li><a class="" href="education.html">Education</a></li>
<li class="book-part">Academic Projects</li>
<li><a class="" href="wage-determinants.html"><span class="header-section-number">1</span> Wage Determinants</a></li>
<li><a class="active" href="life-expenctancy.html"><span class="header-section-number">2</span> Life Expenctancy</a></li>
<li class="book-part">Personal Projects</li>
<li><a class="" href="housing-prices-prediction.html"><span class="header-section-number">3</span> Housing Prices Prediction</a></li>
<li><a class="" href="customer-churn-prediction.html"><span class="header-section-number">4</span> Customer Churn Prediction</a></li>
<li><a class="" href="weather-visualization.html"><span class="header-section-number">5</span> Weather Visualization</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/twozd830/Projects">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="life-expenctancy" class="section level1" number="2">
<h1>
<span class="header-section-number">2</span> Life Expenctancy<a class="anchor" aria-label="anchor" href="#life-expenctancy"><i class="fas fa-link"></i></a>
</h1>
<div id="mortality-rates" class="section level2" number="2.1">
<h2>
<span class="header-section-number">2.1</span> Mortality rates<a class="anchor" aria-label="anchor" href="#mortality-rates"><i class="fas fa-link"></i></a>
</h2>
<p>The following codes compare mortality rates across the ages ranging from zero to one hundred and ten.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">full_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/cloud/project/csvfiles/full_df.csv"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>qx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">qx</span><span class="op">)</span>,</span>
<span>              lx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">lx</span><span class="op">)</span>,</span>
<span>              dx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">dx</span><span class="op">)</span>,</span>
<span>              year<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span>
<span>              Age <span class="op">=</span> <span class="va">age</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter USA, 2019. line: qx~Age by gender</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">full_df</span> <span class="op">%&gt;%</span> </span>
<span>         <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span><span class="op">==</span><span class="st">"USA"</span>,</span>
<span>                <span class="va">year</span><span class="op">==</span><span class="fl">2019</span><span class="op">)</span>, </span>
<span>       <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">Age</span>, y<span class="op">=</span><span class="va">qx</span>,group<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_line</span><span class="op">(</span>col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"Age x"</span>, </span>
<span>     y<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Mortality rate "</span>, </span>
<span>                         <span class="va">q</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     title<span class="op">=</span><span class="st">"Mortality rates (U.S.A., 2019)"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">gender</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure">
<img src="academicprojects_files/figure-html/unnamed-chunk-20-1.png" width="90%" style="display: block; margin: auto;">
The look is similar to the graph of an exponential function so it is suggested that taking logarithm and we may have further insights.</div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter USA, 2019. line: log(qx)~Age by gender</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">full_df</span> <span class="op">%&gt;%</span> </span>
<span>         <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span><span class="op">==</span><span class="st">"USA"</span>,</span>
<span>                <span class="va">year</span><span class="op">==</span><span class="fl">2019</span><span class="op">)</span>, </span>
<span>       <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">Age</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">qx</span><span class="op">)</span>,group<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_line</span><span class="op">(</span>col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"Age x"</span>, </span>
<span>     y<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Log Mortality rate "</span>, </span>
<span>                         <span class="va">q</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     title<span class="op">=</span><span class="st">"Log Mortality rates (U.S.A., 2019)"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">gender</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure">
<img src="academicprojects_files/figure-html/unnamed-chunk-21-1.png" width="90%" style="display: block; margin: auto;">
A glance at this log mortality graph indicates three important features of the evolution of mortality rates:</div>
<ol style="list-style-type: decimal">
<li>The rate for infants is locally high for the newborns, then it decreases.<br>
</li>
<li>It shows an upward hiccup around the age of eighteen. This is called the accident hump. The accident hump is often caused by increased fatalities from car accidents and is (usually more pronounced) in males compared to females.<br>
</li>
<li>And then it straightens back again, reflecting the human aging process.</li>
</ol>
</div>
<div id="survival-probablity" class="section level2" number="2.2">
<h2>
<span class="header-section-number">2.2</span> Survival probablity<a class="anchor" aria-label="anchor" href="#survival-probablity"><i class="fas fa-link"></i></a>
</h2>
<p>It is convenient to illustrate this section using examples. We calculate the 5-year survival probability of an 18-year-old. First extract px as 1 minus qx stored in the life table. We need the survival probability of an 18-year old until a 22-year-old. We then multiply these one-year survival probabilities to get the 5-year survival probability. Using the prod() function on the vector of relevant one-year survival probabilities gives you the result.
<span class="math display">\[{}_{k}p_{x}=p_x.p_{x+1}...p_{x+k-1}\]</span>
Alternatively, we could evaluate this probability as the division of the number of alive people <span class="math inline">\(l_x\)</span> in different ages. Up to rounding errors, both calculations lead to the same result!
<span class="math display">\[{}_{k}p_{x}=\frac{l_{x+k}}{l_{x}}\]</span></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter USA,2019, Age&gt;=18</span></span>
<span><span class="co"># Add column survival</span></span>
<span><span class="co"># line: survival~1:92 (18-110) by gender</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">full_df</span> <span class="op">%&gt;%</span> </span>
<span>         <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span><span class="op">==</span><span class="st">"USA"</span>,</span>
<span>                <span class="va">year</span><span class="op">==</span><span class="fl">2019</span>,</span>
<span>                <span class="va">Age</span><span class="op">&gt;=</span><span class="fl">18</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>         <span class="fu">group_by</span><span class="op">(</span><span class="va">gender</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>         <span class="fu">mutate</span><span class="op">(</span>survival<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumprod</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">qx</span><span class="op">)</span>,</span>
<span>                k<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>         <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">k</span>,y<span class="op">=</span><span class="va">survival</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_line</span><span class="op">(</span>col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"k"</span>, </span>
<span>     y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">""</span><span class="op">[</span><span class="va">k</span><span class="op">]</span>, <span class="st">"p"</span><span class="op">[</span><span class="fl">18</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     title<span class="op">=</span><span class="st">"Survival probabilities for people </span></span>
<span><span class="st">            in age 18, 2019, U.S.A."</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">gender</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure">
<img src="academicprojects_files/figure-html/unnamed-chunk-22-1.png" width="90%" style="display: block; margin: auto;">
This graph indicates the probability of how many more years people would still be alive after the age of eighteen, for example, the chance of an eighteen girl to survive more fifty years up to sixty-eight years old should be about ninety percent.</div>
</div>
<div id="life-expectancy" class="section level2" number="2.3">
<h2>
<span class="header-section-number">2.3</span> Life expectancy<a class="anchor" aria-label="anchor" href="#life-expectancy"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s start from the future lifetime, <span class="math inline">\(K_x\)</span>, that is the number of whole years lived by (x). The probability that Kx takes value k is the probability that an x-year-old survives k years and then dies within the next year, at age x+k. Further manipulation shows that this probability is the difference between the k and the (k+1)-year survival probability of an x-year-old.
<span class="math display">\[P(K_x=k)={}_{k}p_{x}.q_{x+k}={}_{k}p_{x}-{}_{k+1}p_{x}\]</span>
We can verify this equivalence empirically for the example of an 18-year-old. What is his 5-year deferred mortality probability? In the first expression you apply the reasoning with the 5-year survival probability and the mortality rate at age 23, while the second expression takes the difference between the 5- and the 6-year survival probability. Both expressions lead to the same result!</p>
<p><span class="math display">\[{}_{k}p_{x}.q_{x+k}\]</span></p>
<p><span class="math display">\[{}_{k}p_{x}-{}_{k+1}p_{x}\]</span></p>
<p>Using the probability function of <span class="math inline">\(K_x\)</span>, it is now straightforward to calculate the expected value of this random variable. That is the life expectancy of an x-year-old, expressed in whole years. For each possible outcome k, you multiply k with the probability that <span class="math inline">\(K_x\)</span> realizes this outcome. Taking the sum then results in the life expectancy. Further simplification leads to a simple expression: the sum of the k-year survival probabilities when k runs from 1 to its maximum possible value.</p>
<p><span class="math display">\[E[K_x]= \sum_{k=0}^{\infty} k \times P(K_x=k) = \sum_{k=0}^{\infty} k \times ({}_{k}p_{x}-{}_{k+1}p_{x}) =  \sum_{k=1}^{\infty}{}_{k}p_{x}\]</span></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to compute the curtate expected future lifetime for a given age and life table</span></span>
<span><span class="va">curtate_future_lifetime</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">age</span>, <span class="va">life_table</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">px</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="va">life_table</span><span class="op">$</span><span class="va">qx</span></span>
<span>  <span class="va">kpx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumprod</a></span><span class="op">(</span><span class="va">px</span><span class="op">[</span><span class="op">(</span><span class="va">age</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">px</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">kpx</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Vector of ages</span></span>
<span><span class="va">ages</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">full_df</span> <span class="op">%&gt;%</span> </span>
<span>           <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span><span class="op">==</span><span class="st">"USA"</span>,</span>
<span>                  <span class="va">year</span><span class="op">==</span><span class="fl">2019</span>,</span>
<span>                  <span class="va">gender</span><span class="op">==</span><span class="st">"F"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>           <span class="fu">mutate</span><span class="op">(</span>Age<span class="op">=</span><span class="fu">replace_na</span><span class="op">(</span><span class="va">Age</span>,<span class="fl">110</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Age</span></span>
<span></span>
<span><span class="co"># Curtate future lifetimes for all ages</span></span>
<span><span class="va">future_lifetimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">ages</span>, </span>
<span>                           <span class="va">curtate_future_lifetime</span>, </span>
<span>                           <span class="va">full_df</span> <span class="op">%&gt;%</span> </span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span><span class="op">==</span><span class="st">"USA"</span>,</span>
<span>                                    <span class="va">year</span><span class="op">==</span><span class="fl">2019</span>,</span>
<span>                                    <span class="va">gender</span><span class="op">==</span><span class="st">"F"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>Age<span class="op">=</span><span class="fu">replace_na</span><span class="op">(</span><span class="va">Age</span>,<span class="fl">110</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># Future lifetime by age</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ages</span>, </span>
<span>     <span class="va">future_lifetimes</span>,</span>
<span>     type <span class="op">=</span> <span class="st">'l'</span>, </span>
<span>     lwd <span class="op">=</span> <span class="fl">2</span>, </span>
<span>     col <span class="op">=</span> <span class="st">"green"</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"Age x"</span>, </span>
<span>     ylab <span class="op">=</span> <span class="st">"Future lifetime"</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Future lifetime by age, females, 2019, U.S.A."</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure">
<img src="academicprojects_files/figure-html/unnamed-chunk-23-1.png" width="90%" style="display: block; margin: auto;">
So it’s quite intuitive that women in the USA live up to 80 years old, and for each more age they live the expected value decreases by 1 forming the linear pattern from zero to eighty, after which we see the extreme cases following just a small little tail.</div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter USA. line qx~Age by gender, color by year</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">full_df</span> <span class="op">%&gt;%</span> </span>
<span>         <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"USA"</span><span class="op">)</span>, </span>
<span>       <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">Age</span>, y<span class="op">=</span><span class="va">qx</span>, color <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>group <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">gender</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"Age x"</span>, </span>
<span>     y<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Mortality rate "</span>, <span class="va">q</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     title<span class="op">=</span><span class="st">"Mortality rates (USA, 1933-2019)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure">
<img src="academicprojects_files/figure-html/unnamed-chunk-24-1.png" width="90%" style="display: block; margin: auto;">
Adding another dimension year to the plot with the attribute color, it is obvious to say as the years proceeded, the mortality rate has been stably improved and thus firmly decreased.
We could try to compare the lifetime across the year between males and females:</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter USA. </span></span>
<span><span class="co"># Add column life_expectancy</span></span>
<span><span class="co"># line: life_expectancy~year, color by gender</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">full_df</span> <span class="op">%&gt;%</span> </span>
<span>         <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"USA"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>         <span class="fu">group_by</span><span class="op">(</span><span class="va">gender</span>,<span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>         <span class="fu">mutate</span><span class="op">(</span>kpx<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumprod</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">qx</span><span class="op">)</span>,</span>
<span>                life_expectancy<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">kpx</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>         <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Age</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> , </span>
<span>       <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>, y <span class="op">=</span> <span class="va">life_expectancy</span>, color <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"Year"</span>, </span>
<span>     y<span class="op">=</span> <span class="st">"Life Expectancy"</span>,</span>
<span>     title<span class="op">=</span><span class="st">"Life Expectancy, U.S.A."</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure">
<img src="academicprojects_files/figure-html/unnamed-chunk-25-1.png" width="90%" style="display: block; margin: auto;">
It is evident to suggest that women outlived, outlive and will outlive men.</div>
</div>
<div id="countries-data" class="section level2" number="2.4">
<h2>
<span class="header-section-number">2.4</span> 40 Countries Data<a class="anchor" aria-label="anchor" href="#countries-data"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add column life_expectancy. </span></span>
<span><span class="co"># Filter Age=0, interesting countries</span></span>
<span><span class="co"># scatter:life_expectancy~year color by country by gender</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">full_df</span> <span class="op">%&gt;%</span></span>
<span>         <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>,<span class="va">country</span>,<span class="va">gender</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>         <span class="fu">mutate</span><span class="op">(</span>Age<span class="op">=</span><span class="fu">replace_na</span><span class="op">(</span><span class="va">Age</span>,<span class="fl">110</span><span class="op">)</span>,</span>
<span>                kpx<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumprod</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">qx</span><span class="op">)</span>,</span>
<span>                life_expectancy<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">kpx</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>                <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Age</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>                <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>,y<span class="op">=</span><span class="va">life_expectancy</span>,color<span class="op">=</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">gender</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Lifetime through years in 40 countries between men and women"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Life Expectancy"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="academicprojects_files/figure-html/unnamed-chunk-26-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>This colorful scatter plot summarizes how the data of 800.000 entries behave when it comes to life duration among top-ranking countries across the years. This may be overwhelming but this gives the strongest evidence for developing lifetime as years going by. What’s more, while the maximum (point of) males is just higher than eighty, that of females converges to the age of ninety just for the next few years.</p>

</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="wage-determinants.html"><span class="header-section-number">1</span> Wage Determinants</a></div>
<div class="next"><a href="housing-prices-prediction.html"><span class="header-section-number">3</span> Housing Prices Prediction</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#life-expenctancy"><span class="header-section-number">2</span> Life Expenctancy</a></li>
<li><a class="nav-link" href="#mortality-rates"><span class="header-section-number">2.1</span> Mortality rates</a></li>
<li><a class="nav-link" href="#survival-probablity"><span class="header-section-number">2.2</span> Survival probablity</a></li>
<li><a class="nav-link" href="#life-expectancy"><span class="header-section-number">2.3</span> Life expectancy</a></li>
<li><a class="nav-link" href="#countries-data"><span class="header-section-number">2.4</span> 40 Countries Data</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/twozd830/Projects/blob/master/academicprojects.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/twozd830/Projects/edit/master/academicprojects.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>David Tran Thanh Dat</strong>" was written by Tran Thanh Dat. It was last built on 2022-09-15.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
